package synapticloop.sample.h2zero.sqlite3.impex;


// - - - - thoughtfully generated by synapticloop h2zero - - - - 
//    with the use of synapticloop templar templating language
//                 (/impex/importer.templar)

import synapticloop.h2zero.exception.H2ZeroParseException;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.io.IOException;

public class Importer {
	/**
	 * Import a data dump from a file
	 *
	 * @param file The file to import the data from
	 * @throws H2ZeroParseException If there was an error parsing the data import
	 */
	public static void importFromFile(File file) throws H2ZeroParseException {
		try (FileReader fileReader = new FileReader(file);
		     BufferedReader bufferedReader = new BufferedReader(fileReader)) {

			String tableType = null;
			String line;
			while ((line = bufferedReader.readLine()) != null) {
				if (line.startsWith("#")) {
					tableType = parseTypeDirective(line);
				} else {
					importLineToTable(tableType, line);
				}
			}
		} catch (IOException ex) {
			throw new H2ZeroParseException(String.format("Could not read from the file '%s'.", file.getAbsolutePath()));
		}
	}

	private static String parseTypeDirective(String line) throws H2ZeroParseException {
		String[] splits = line.split("\t");
		if(splits.length != 3) {
			throw new H2ZeroParseException("Could not parse the type directive.");
		}

		// TODO - maybe check to see whether this is a table directive
		return(splits[2]);
	}

	private static void importLineToTable(String tableType, String line) throws H2ZeroParseException {
		if (null == tableType ||tableType.isBlank()) {
			throw new H2ZeroParseException("Could not import a table where the type is null or empty.");
		}

		switch (tableType) {
			case "ALL_TYPES":
				AllTypesImporter.importLine(line);
				break;
			case "AUTHOR_STATUS":
				AuthorStatusImporter.importLine(line);
				break;
			case "AUTHOR":
				AuthorImporter.importLine(line);
				break;
			case "USER_TYPE":
				UserTypeImporter.importLine(line);
				break;
			case "USER_TITLE":
				UserTitleImporter.importLine(line);
				break;
			case "USER":
				UserImporter.importLine(line);
				break;
			case "PET":
				PetImporter.importLine(line);
				break;
			case "USER_PET":
				UserPetImporter.importLine(line);
				break;
			default:
				throw new H2ZeroParseException(String.format("Don't know how to import table of type '%s'", tableType));
		}

	}
}